
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>mlcourse.ai - Open Machine Learning Course &#8212; Mlcourse.ai</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Mlcourse.ai</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="landing-page.html">
   My book title
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="assignment01_pandas_uci_adult.html">
   mlcourse.ai - Open Machine Learning Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment01_pandas_uci_adult.html#center-assignment-1-demo">
   <center>
    Assignment #1 (demo)
   </center>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment01_pandas_uci_adult_solution.html">
   mlcourse.ai - Open Machine Learning Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment01_pandas_uci_adult_solution.html#center-assignment-1-demo-solution">
   <center>
    Assignment #1 (demo). Solution
   </center>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment10_flight_delays_kaggle.html">
   <center>
    Assignment #10 (demo)
   </center>
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/assignment05_logit_rf_credit_scoring_solution.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/assignment05_logit_rf_credit_scoring_solution.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   mlcourse.ai - Open Machine Learning Course
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#center-assignment-5-demo-solution-center">
   <center>
    Assignment # 5 (demo). Solution
   </center>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#center-logistic-regression-and-random-forest-in-the-credit-scoring-problem-center">
     <center>
      Logistic Regression and Random Forest in the credit scoring problem
     </center>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#credit-scoring-problem-setup">
     Credit scoring problem setup
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#problem">
       Problem
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#data-description">
       Data description
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bootstrapping">
     Bootstrapping
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#logistic-regression">
     Logistic regression
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-importance">
     Feature importance
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-forest">
     Random Forest
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bagging">
     Bagging
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <center>
<img src="../../img/ods_stickers.jpg">
<div class="section" id="mlcourse-ai-open-machine-learning-course">
<h1><a class="reference external" href="https://mlcourse.ai">mlcourse.ai</a> - Open Machine Learning Course<a class="headerlink" href="#mlcourse-ai-open-machine-learning-course" title="Permalink to this headline">¶</a></h1>
<p>Author: Vitaly Radchenko. All content is distributed under the <a class="reference external" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons CC BY-NC-SA 4.0</a> license.</p>
</div>
<div class="section" id="center-assignment-5-demo-solution-center">
<h1><center>Assignment # 5 (demo). Solution</center><a class="headerlink" href="#center-assignment-5-demo-solution-center" title="Permalink to this headline">¶</a></h1>
<div class="section" id="center-logistic-regression-and-random-forest-in-the-credit-scoring-problem-center">
<h2><center>Logistic Regression and Random Forest in the credit scoring problem</center><a class="headerlink" href="#center-logistic-regression-and-random-forest-in-the-credit-scoring-problem-center" title="Permalink to this headline">¶</a></h2>
<p><strong>Same assignment as a <a class="reference external" href="https://www.kaggle.com/kashnitsky/a5-demo-logit-and-rf-for-credit-scoring-sol">Kaggle Kernel</a> + <a class="reference external" href="https://www.kaggle.com/kashnitsky/a5-demo-logit-and-rf-for-credit-scoring-sol">solution</a>.</strong></p>
<p>In this assignment, you will build models and answer questions using data on credit scoring.</p>
<p>Please write your code in the cells with the “Your code here” placeholder. Then, answer the questions in the <a class="reference external" href="https://goo.gl/forms/xaXU8C0gYuTGPuyG3">form</a>.</p>
<p>Let’s start with a warm-up exercise.</p>
<p><strong>Question 1.</strong> There are 5 jurors in a courtroom. Each of them can correctly identify the guilt of the defendant with 70% probability, independent of one another. What is the probability that the jurors will jointly reach the correct verdict if the final decision is by majority vote?</p>
<ol class="simple">
<li><p>70.00%</p></li>
<li><p>83.20%</p></li>
<li><p>83.70%</p></li>
<li><p>87.50%</p></li>
</ol>
<p><strong>Answer:</strong> 3.</p>
<p><strong>Solution:</strong></p>
<p>We will use the formula for <span class="math notranslate nohighlight">\(\mu\)</span> from the article. Since the majority of votes begin with <span class="math notranslate nohighlight">\(3\)</span>, then <span class="math notranslate nohighlight">\(m = 3, ~N = 5, ~p = 0.7\)</span>. Substitute these values into the formula to get:</p>
<div class="math notranslate nohighlight">
\[\large \mu = \sum_{i=3}^{5}{5 \choose i}0.7^i(1-0.7)^{5-i} = 83.70\%\]</div>
<p>Great! Let’s move on to machine learning.</p>
</div>
<div class="section" id="credit-scoring-problem-setup">
<h2>Credit scoring problem setup<a class="headerlink" href="#credit-scoring-problem-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem">
<h3>Problem<a class="headerlink" href="#problem" title="Permalink to this headline">¶</a></h3>
<p>Predict whether the customer will repay their credit within 90 days. This is a binary classification problem; we will assign customers into good or bad categories based on our prediction.</p>
</div>
<div class="section" id="data-description">
<h3>Data description<a class="headerlink" href="#data-description" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Feature</p></th>
<th class="text-align:left head"><p>Variable Type</p></th>
<th class="text-align:left head"><p>Value Type</p></th>
<th class="text-align:left head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>age</p></td>
<td class="text-align:left"><p>Input Feature</p></td>
<td class="text-align:left"><p>integer</p></td>
<td class="text-align:left"><p>Customer age</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>DebtRatio</p></td>
<td class="text-align:left"><p>Input Feature</p></td>
<td class="text-align:left"><p>real</p></td>
<td class="text-align:left"><p>Total monthly loan payments (loan, alimony, etc.) / Total monthly income percentage</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>NumberOfTime30-59DaysPastDueNotWorse</p></td>
<td class="text-align:left"><p>Input Feature</p></td>
<td class="text-align:left"><p>integer</p></td>
<td class="text-align:left"><p>The number of cases when client has overdue 30-59 days (not worse) on other loans during the last 2 years</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>NumberOfTimes90DaysLate</p></td>
<td class="text-align:left"><p>Input Feature</p></td>
<td class="text-align:left"><p>integer</p></td>
<td class="text-align:left"><p>Number of cases when customer had 90+dpd overdue on other credits</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>NumberOfTime60-89DaysPastDueNotWorse</p></td>
<td class="text-align:left"><p>Input Feature</p></td>
<td class="text-align:left"><p>integer</p></td>
<td class="text-align:left"><p>Number of cased when customer has 60-89dpd (not worse) during the last 2 years</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>NumberOfDependents</p></td>
<td class="text-align:left"><p>Input Feature</p></td>
<td class="text-align:left"><p>integer</p></td>
<td class="text-align:left"><p>The number of customer dependents</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>SeriousDlqin2yrs</p></td>
<td class="text-align:left"><p>Target Variable</p></td>
<td class="text-align:left"><p>binary: <br>0 or 1</p></td>
<td class="text-align:left"><p>Customer hasn’t paid the loan debt within 90 days</p></td>
</tr>
</tbody>
</table>
<p>Let’s set up our environment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disable warnings in Anaconda</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s write the function that will replace <em>NaN</em> values with the median for each column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fill_nan</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">table</span>   
</pre></div>
</div>
</div>
</div>
<p>Now, read the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../data/credit_scoring_sample.csv&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SeriousDlqin2yrs</th>
      <th>age</th>
      <th>NumberOfTime30-59DaysPastDueNotWorse</th>
      <th>DebtRatio</th>
      <th>NumberOfTimes90DaysLate</th>
      <th>NumberOfTime60-89DaysPastDueNotWorse</th>
      <th>MonthlyIncome</th>
      <th>NumberOfDependents</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>64</td>
      <td>0</td>
      <td>0.249908</td>
      <td>0</td>
      <td>0</td>
      <td>8158.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>58</td>
      <td>0</td>
      <td>3870.000000</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>41</td>
      <td>0</td>
      <td>0.456127</td>
      <td>0</td>
      <td>0</td>
      <td>6666.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>43</td>
      <td>0</td>
      <td>0.000190</td>
      <td>0</td>
      <td>0</td>
      <td>10500.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>49</td>
      <td>0</td>
      <td>0.271820</td>
      <td>0</td>
      <td>0</td>
      <td>400.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Look at the variable types:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SeriousDlqin2yrs                          int64
age                                       int64
NumberOfTime30-59DaysPastDueNotWorse      int64
DebtRatio                               float64
NumberOfTimes90DaysLate                   int64
NumberOfTime60-89DaysPastDueNotWorse      int64
MonthlyIncome                           float64
NumberOfDependents                      float64
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Check the class balance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SeriousDlqin2yrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;number_of_observations&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;unique_value&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Target distribution&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distribution of the target:&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;SeriousDlqin2yrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribution of the target:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.777511
1    0.222489
Name: SeriousDlqin2yrs, dtype: float64
</pre></div>
</div>
<img alt="_images/assignment05_logit_rf_credit_scoring_solution_16_2.png" src="_images/assignment05_logit_rf_credit_scoring_solution_16_2.png" />
</div>
</div>
<p>Separate the input variable names by excluding the target:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">independent_columns_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;SeriousDlqin2yrs&#39;</span><span class="p">]</span>
<span class="n">independent_columns_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;age&#39;,
 &#39;NumberOfTime30-59DaysPastDueNotWorse&#39;,
 &#39;DebtRatio&#39;,
 &#39;NumberOfTimes90DaysLate&#39;,
 &#39;NumberOfTime60-89DaysPastDueNotWorse&#39;,
 &#39;MonthlyIncome&#39;,
 &#39;NumberOfDependents&#39;]
</pre></div>
</div>
</div>
</div>
<p>Apply the function to replace <em>NaN</em> values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">fill_nan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Separate the target variable and input features:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">independent_columns_names</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;SeriousDlqin2yrs&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="bootstrapping">
<h2>Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permalink to this headline">¶</a></h2>
<p><strong>Question 2.</strong> Make an interval estimate of the average age for the customers who delayed the repayment with the confidence level equal 90%. Use the example from the article for reference. Also, use <code class="docutils literal notranslate"><span class="pre">np.random.seed(0)</span></code> as it was done in the article. What is the resulting interval estimate?</p>
<ol class="simple">
<li><p>52.59 – 52.86</p></li>
<li><p>45.71 – 46.13</p></li>
<li><p>45.68 – 46.17</p></li>
<li><p>52.56 – 52.88</p></li>
</ol>
<p><strong>Answer:</strong> 2.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_bootstrap_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate samples using bootstrapping.&quot;&quot;&quot;</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">samples</span>

<span class="k">def</span> <span class="nf">stat_intervals</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make an interval estimate.&quot;&quot;&quot;</span>
    <span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">boundaries</span>

<span class="c1"># Save the ages of those who let a delay</span>
<span class="n">churn</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SeriousDlqin2yrs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Set the random seed for reproducibility </span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Generate bootstrap samples and calculate the mean for each sample</span>
<span class="n">churn_mean_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">get_bootstrap_samples</span><span class="p">(</span><span class="n">churn</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

<span class="c1"># Print the interval estimate for the sample means</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean interval&quot;</span><span class="p">,</span> <span class="n">stat_intervals</span><span class="p">(</span><span class="n">churn_mean_scores</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean interval [45.71379414 46.12700479]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="logistic-regression">
<h2>Logistic regression<a class="headerlink" href="#logistic-regression" title="Permalink to this headline">¶</a></h2>
<p>Let’s set up to use logistic regression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will create a LogisticRegression model and use class_weight=’balanced’ to make up for our unbalanced classes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try to find the best regularization coefficient, which is the coefficient <code class="docutils literal notranslate"><span class="pre">C</span></code> for logistic regression. Then, we will have an optimal model that is not overfit and is a good predictor of the target variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<p>In order to find the optimal value of <code class="docutils literal notranslate"><span class="pre">C</span></code>, let’s apply stratified 5-fold validation and look at the <em>ROC AUC</em> against different values of the parameter <code class="docutils literal notranslate"><span class="pre">C</span></code>. Use the <code class="docutils literal notranslate"><span class="pre">StratifiedKFold</span></code> function for this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>One of the important metrics of model quality is the <em>Area Under the Curve (AUC)</em>. <em>ROC AUC</em> varies from 0 to 1. The closer ROC AUC to 1, the better the quality of the classification model.</p>
<p><strong>Question 3.</strong> Perform a <em>Grid Search</em> with the scoring metric “roc_auc” for the parameter <code class="docutils literal notranslate"><span class="pre">C</span></code>. Which value of the parameter <code class="docutils literal notranslate"><span class="pre">C</span></code> is optimal?</p>
<ol class="simple">
<li><p>0.0001</p></li>
<li><p>0.001</p></li>
<li><p>0.01</p></li>
<li><p>0.1</p></li>
<li><p>1</p></li>
<li><p>10</p></li>
</ol>
<p><strong>Answer:</strong> 2.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">)</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LogisticRegression(C=0.001, class_weight=&#39;balanced&#39;, dual=False,
          fit_intercept=True, intercept_scaling=1, max_iter=100,
          multi_class=&#39;ovr&#39;, n_jobs=1, penalty=&#39;l2&#39;, random_state=5,
          solver=&#39;liblinear&#39;, tol=0.0001, verbose=0, warm_start=False)
</pre></div>
</div>
</div>
</div>
<p><strong>Question 4.</strong> Can we consider the best model stable? The model is <em>stable</em> if the standard deviation on validation is less than 0.5%. Save the <em>ROC AUC</em> value of the best model, it will be useful for the following tasks.</p>
<ol class="simple">
<li><p>Yes</p></li>
<li><p>No</p></li>
</ol>
<p><strong>Answer:</strong> 2.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;std_test_score&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.006357471890470392
</pre></div>
</div>
</div>
</div>
<p>The <em>ROC AUC</em> value of the best model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.795409411236062
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="feature-importance">
<h2>Feature importance<a class="headerlink" href="#feature-importance" title="Permalink to this headline">¶</a></h2>
<p><strong>Question 5.</strong> <em>Feature importance</em> is defined by the absolute value of its corresponding coefficient. First you need to normalize all the feature values so that it will be correct to compare them. What is the most important feature for the best logistic regression model?</p>
<ol class="simple">
<li><p>age</p></li>
<li><p>NumberOfTime30-59DaysPastDueNotWorse</p></li>
<li><p>DebtRatio</p></li>
<li><p>NumberOfTimes90DaysLate</p></li>
<li><p>NumberOfTime60-89DaysPastDueNotWorse</p></li>
<li><p>MonthlyIncome</p></li>
<li><p>NumberOfDependents</p></li>
</ol>
<p><strong>Answer:</strong> 2.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)</span>
<span class="n">scal</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;feat&#39;</span><span class="p">:</span> <span class="n">independent_columns_names</span><span class="p">,</span>
              <span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>feat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.724004</td>
      <td>NumberOfTime30-59DaysPastDueNotWorse</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.517673</td>
      <td>NumberOfTimes90DaysLate</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.194732</td>
      <td>NumberOfTime60-89DaysPastDueNotWorse</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.101326</td>
      <td>NumberOfDependents</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.024082</td>
      <td>DebtRatio</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.162864</td>
      <td>MonthlyIncome</td>
    </tr>
    <tr>
      <th>0</th>
      <td>-0.416304</td>
      <td>age</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Question 6.</strong> Calculate how much <code class="docutils literal notranslate"><span class="pre">DebtRatio</span></code> affects the prediction using the <a class="reference external" href="https://en.wikipedia.org/wiki/Softmax_function">softmax function</a>. What is its value?</p>
<ol class="simple">
<li><p>0.38</p></li>
<li><p>-0.02</p></li>
<li><p>0.11</p></li>
<li><p>0.24</p></li>
</ol>
<p><strong>Answer:</strong> 3.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">])))[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.11420536719928259
</pre></div>
</div>
</div>
</div>
<p><strong>Question 7.</strong> Let’s see how we can interpret the impact of our features. For this, recalculate the logistic regression with absolute values, that is without scaling. Next, modify the customer’s age by adding 20 years, keeping the other features unchanged. How many times will the chance that the customer will not repay their debt increase? You can find an example of the theoretical calculation <a class="reference external" href="https://www.unm.edu/~schrader/biostat/bio2/Spr06/lec11.pdf">here</a>.</p>
<ol class="simple">
<li><p>-0.01</p></li>
<li><p>0.70</p></li>
<li><p>8.32</p></li>
<li><p>0.66</p></li>
</ol>
<p><strong>Answer:</strong> 2.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;feat&#39;</span><span class="p">:</span> <span class="n">independent_columns_names</span><span class="p">,</span>
              <span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>feat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.482349</td>
      <td>NumberOfTime30-59DaysPastDueNotWorse</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.430314</td>
      <td>NumberOfTimes90DaysLate</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.115356</td>
      <td>NumberOfDependents</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.065958</td>
      <td>NumberOfTime60-89DaysPastDueNotWorse</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.000011</td>
      <td>DebtRatio</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.000011</td>
      <td>MonthlyIncome</td>
    </tr>
    <tr>
      <th>0</th>
      <td>-0.018185</td>
      <td>age</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6950957781347274
</pre></div>
</div>
</div>
</div>
<p>It is <span class="math notranslate nohighlight">\(\exp^{\beta\delta}\)</span> times more likely that the customer won’t repay the debt, where <span class="math notranslate nohighlight">\(\delta\)</span> is the feature value increment. That means that if we increased the age by 20 years, the odds that the customer won’t repay would increase by 0.69 times.</p>
</div>
<div class="section" id="random-forest">
<h2>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this headline">¶</a></h2>
<p>Import the Random Forest classifier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
</pre></div>
</div>
</div>
</div>
<p>Initialize Random Forest with 100 trees and balance target classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> 
                            <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will search for the best parameters among the following values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<p>Also, we will use the stratified k-fold validation again. You should still have the <code class="docutils literal notranslate"><span class="pre">skf</span></code> variable.</p>
<p><strong>Question 8.</strong> How much higher the <em>ROC AUC</em> of the best random forest model than that of the best logistic regression on validation?</p>
<ol class="simple">
<li><p>4%</p></li>
<li><p>3%</p></li>
<li><p>2%</p></li>
<li><p>1%</p></li>
</ol>
<p><strong>Answer:</strong> 1.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">rf_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rf_grid_search</span> <span class="o">=</span> <span class="n">rf_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rf_grid_search</span><span class="o">.</span><span class="n">best_score_</span> <span class="o">-</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 36 candidates, totalling 180 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:   58.5s
[Parallel(n_jobs=-1)]: Done 180 out of 180 | elapsed:  7.5min finished
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.039645547841116846
CPU times: user 9.23 s, sys: 316 ms, total: 9.54 s
Wall time: 7min 30s
</pre></div>
</div>
</div>
</div>
<p><strong>Question 9.</strong> What feature has the weakest impact in Random Forest model?</p>
<ol class="simple">
<li><p>age</p></li>
<li><p>NumberOfTime30-59DaysPastDueNotWorse</p></li>
<li><p>DebtRatio</p></li>
<li><p>NumberOfTimes90DaysLate</p></li>
<li><p>NumberOfTime60-89DaysPastDueNotWorse</p></li>
<li><p>MonthlyIncome</p></li>
<li><p>NumberOfDependents</p></li>
</ol>
<p><strong>Answer:</strong> 7.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">independent_columns_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">rf_grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;NumberOfDependents&#39;
</pre></div>
</div>
</div>
</div>
<p>Rating of the feature importance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;feat&#39;</span><span class="p">:</span> <span class="n">independent_columns_names</span><span class="p">,</span>
              <span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="n">rf_grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>feat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.302461</td>
      <td>NumberOfTime30-59DaysPastDueNotWorse</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.278644</td>
      <td>NumberOfTimes90DaysLate</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.148683</td>
      <td>NumberOfTime60-89DaysPastDueNotWorse</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.115926</td>
      <td>age</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.079520</td>
      <td>DebtRatio</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.060429</td>
      <td>MonthlyIncome</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.014337</td>
      <td>NumberOfDependents</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Question 10.</strong> What is the most significant advantage of using <em>Logistic Regression</em> versus <em>Random Forest</em> for this problem?</p>
<ol class="simple">
<li><p>Spent less time for model fitting;</p></li>
<li><p>Fewer variables to iterate;</p></li>
<li><p>Feature interpretability;</p></li>
<li><p>Linear properties of the algorithm.</p></li>
</ol>
<p><strong>Answer:</strong> 3.</p>
<p><strong>Solution:</strong></p>
<p>On the one hand, the Random Forest model works better for our credit scoring problem. Its performance is 4% higher. The reason for such a result is a small number of features and the compositional property of random forests.</p>
<p>On the other hand, the main advantage of Logistic Regression is that we can interpret the feature impact on the model outcome.</p>
</div>
<div class="section" id="bagging">
<h2>Bagging<a class="headerlink" href="#bagging" title="Permalink to this headline">¶</a></h2>
<p>Import modules and set up the parameters for bagging:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">BaggingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">RandomizedSearchCV</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;max_samples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> 
              <span class="s1">&#39;base_estimator__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 11.</strong> Fit a bagging classifier with <code class="docutils literal notranslate"><span class="pre">random_state=42</span></code>. For the base classifiers, use 100 logistic regressors and use <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> instead of <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>. It will take a lot of time to iterate over all 54 variants, so set the maximum number of iterations for <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code> to 20. Don’t forget to set the parameters <code class="docutils literal notranslate"><span class="pre">cv</span></code> and <code class="docutils literal notranslate"><span class="pre">random_state=1</span></code>. What is the best <em>ROC AUC</em> you achieve?</p>
<ol class="simple">
<li><p>80.75%</p></li>
<li><p>80.12%</p></li>
<li><p>79.62%</p></li>
<li><p>76.50%</p></li>
</ol>
<p><strong>Answer:</strong> 1.</p>
<p><strong>Solution:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bg</span> <span class="o">=</span> <span class="n">BaggingClassifier</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">),</span>
                       <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">r_grid_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">r_grid_search</span> <span class="o">=</span> <span class="n">r_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 20 candidates, totalling 100 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed:  7.0min
[Parallel(n_jobs=-1)]: Done 100 out of 100 | elapsed: 16.9min finished
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_grid_search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8076172570918905
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BaggingClassifier(base_estimator=LogisticRegression(C=0.001, class_weight=&#39;balanced&#39;, dual=False,
          fit_intercept=True, intercept_scaling=1, max_iter=100,
          multi_class=&#39;ovr&#39;, n_jobs=1, penalty=&#39;l2&#39;, random_state=None,
          solver=&#39;liblinear&#39;, tol=0.0001, verbose=0, warm_start=False),
         bootstrap=True, bootstrap_features=False, max_features=2,
         max_samples=0.7, n_estimators=100, n_jobs=-1, oob_score=False,
         random_state=42, verbose=0, warm_start=False)
</pre></div>
</div>
</div>
</div>
<p><strong>Question 12.</strong> Give an interpretation of the best parameters for bagging. Why are these values of <code class="docutils literal notranslate"><span class="pre">max_features</span></code> and <code class="docutils literal notranslate"><span class="pre">max_samples</span></code> the best?</p>
<ol class="simple">
<li><p>For bagging it’s important to use as few features as possible;</p></li>
<li><p>Bagging works better on small samples;</p></li>
<li><p>Less correlation between single models;</p></li>
<li><p>The higher the number of features, the lower the loss of information.</p></li>
</ol>
<p><strong>Answer:</strong> 3.</p>
<p><strong>Solution:</strong></p>
<p>The advantage of <em>Random Forest</em> is that the trees in the composition are not highly correlated. Similarly, for bagging with logistic regression, the weaker correlation between single models, the higher the accuracy. Since in logistic regression there is almost no randomness, we have to change the set of features to minimize the correlation between our single models.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>